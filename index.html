<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="当编程成为一种习惯...">
<meta name="keywords" content="程序媛">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiaopili&#39;s Blogs">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Xiaopili&#39;s Blogs">
<meta property="og:description" content="当编程成为一种习惯...">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xiaopili&#39;s Blogs">
<meta name="twitter:description" content="当编程成为一种习惯...">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Xiaopili's Blogs</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xiaopili's Blogs</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">人家灵着呢~</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/11/自动测试技术的适用范围与工具使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiao.liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/14329197?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaopili's Blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/11/自动测试技术的适用范围与工具使用/" itemprop="url">自动测试技术的适用范围与工具使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-11T14:11:33+08:00">
                2018-10-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/测试类分享/" itemprop="url" rel="index">
                    <span itemprop="name">测试类分享</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、自动化测试技术的优势"><a href="#一、自动化测试技术的优势" class="headerlink" title="一、自动化测试技术的优势"></a>一、自动化测试技术的优势</h2><p>1.<strong>对程序的回归测试更方便。</strong>这可能是自动化测试最主要的任务，特别是在程序修改比较频繁时，效果是非常明显的。由于回归测试的动作和用例是完全设计好的，测试期望的结果也是完全可以预料的，将回归测试自动运行，可以极大提高测试效率，缩短回归测试时间。</p>
<p>2.<strong>可以运行更多更繁琐的测试。</strong>自动化的一个明显的好处是可以在较少的时间内运行更多的测试。</p>
<p>3.<strong>可以执行一些手工测试困难或不可能进行的测试。</strong>比如，对于大量用户的测试，不可能同时让足够多的测试人员同时进行测试，但是却可以通过自动化测试模拟同时有许多用户，从而达到测试的目的。</p>
<p>4.<strong>更好地利用资源。</strong>将繁琐的任务自动化，可以提高准确性和测试人员的积极性，将测试技术人员解脱出来投入更多精力设计更好的测试用例。有些测试不适合于自动测试，仅适合于手工测试，将可自动测试的测试自动化后，可以让测试人员专注于手工测试部分，提高手工测试的效率。</p>
<p>5.<strong>测试具有一致性和可重复性。</strong>由于测试是自动执行的，每次测试的结果和执行的内容的一致性是可以得到保障的，从而达到测试的可重复的效果。</p>
<p>6.<strong>测试的复用性。</strong>由于自动测试通常采用脚本技术，这样就有可能只需要做少量的甚至不做修改，实现在不同的测试过程中使用相同的用例。</p>
<p>7.<strong>增加工程信任度。</strong>由于测试是自动执行的，所以不存在执行过程中的疏忽和错误，完全取决于测试的设计质量。一旦工程通过了强有力的自动测试后，工程的信任度自然会增加。</p>
<h2 id="二、自动化测试技术的适用范围及工具介绍"><a href="#二、自动化测试技术的适用范围及工具介绍" class="headerlink" title="二、自动化测试技术的适用范围及工具介绍"></a>二、自动化测试技术的适用范围及工具介绍</h2><h3 id="1-web前端"><a href="#1-web前端" class="headerlink" title="1.web前端"></a>1.web前端</h3><h5 id="一、e2e"><a href="#一、e2e" class="headerlink" title="一、e2e"></a>一、e2e</h5><ul>
<li>CasperJS — 6460 个 star，<a href="http://casperjs.org/" target="_blank" rel="noopener">官网</a>，<a href="https://github.com/casperjs/casperjs" target="_blank" rel="noopener">github</a>；</li>
<li>Protractor — 6408 个 star，<a href="http://www.protractortest.org/#/" target="_blank" rel="noopener">官网</a>，<a href="https://github.com/angular/protractor" target="_blank" rel="noopener">github</a>；</li>
<li>Nightwatch.js — 6121 个 star，<a href="http://nightwatchjs.org/" target="_blank" rel="noopener">官网</a>，<a href="https://github.com/nightwatchjs/nightwatch" target="_blank" rel="noopener">github</a>；</li>
<li>TestCafe — 2268 个 star，<a href="https://devexpress.github.io/testcafe/" target="_blank" rel="noopener">官网</a>，<a href="https://github.com/DevExpress/testcafe" target="_blank" rel="noopener">github</a>；</li>
<li>CodeceptJS — 1087 个 star，<a href="https://codecept.io/" target="_blank" rel="noopener">官网</a>，<a href="https://github.com/Codeception/CodeceptJS" target="_blank" rel="noopener">github</a>；</li>
</ul>
<h5 id="二、unit"><a href="#二、unit" class="headerlink" title="二、unit"></a>二、unit</h5><ul>
<li>Jasmine — 13921 个 star，<a href="https://jasmine.github.io/" target="_blank" rel="noopener">官网</a>，<a href="https://github.com/jasmine/jasmine" target="_blank" rel="noopener">github</a></li>
<li>Qunit - 3791 个 star，<a href="http://qunitjs.com/" target="_blank" rel="noopener">官网</a>，<a href="https://github.com/qunitjs/qunit.git" target="_blank" rel="noopener">github</a></li>
<li>Sinon - 6483 个 star，<a href="https://sinonjs.org/" target="_blank" rel="noopener">官网</a>，<a href="https://github.com/sinonjs/sinon" target="_blank" rel="noopener">github</a></li>
<li>Mocha - 16469 个 star，<a href="https://mochajs.org/" target="_blank" rel="noopener">官网</a>，<a href="https://github.com/mochajs/mocha" target="_blank" rel="noopener">github</a></li>
</ul>
<h5 id="三、断言库"><a href="#三、断言库" class="headerlink" title="三、断言库"></a>三、断言库</h5><ul>
<li>better-assert - 254 个 star，<a href="https://github.com/tj/better-assert" target="_blank" rel="noopener">github</a></li>
<li>should.js - 1751 个 star，<a href="https://github.com/shouldjs/should.js" target="_blank" rel="noopener">github</a></li>
<li>expect.js - 1936 个 star，<a href="https://github.com/Automattic/expect.js" target="_blank" rel="noopener">github</a></li>
<li>chai - 5782 个 star，<a href="https://github.com/chaijs/chai" target="_blank" rel="noopener">github</a></li>
</ul>
<h3 id="2-服务端"><a href="#2-服务端" class="headerlink" title="2.服务端"></a>2.服务端</h3><p>1.测试库：<a href="https://mochajs.org/" target="_blank" rel="noopener">Mocha</a><br>2.断言库：<a href="https://shouldjs.github.io/" target="_blank" rel="noopener">Should</a><br>3.测试HTTP接口：<a href="https://github.com/visionmedia/supertest" target="_blank" rel="noopener">SuperTest</a></p>
<h2 id="三、web前端自动化测试实例"><a href="#三、web前端自动化测试实例" class="headerlink" title="三、web前端自动化测试实例"></a>三、web前端自动化测试实例</h2><h3 id="vue的自动化测试"><a href="#vue的自动化测试" class="headerlink" title="vue的自动化测试"></a>vue的自动化测试</h3><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><h5 id="为什么我们需要测试？"><a href="#为什么我们需要测试？" class="headerlink" title="为什么我们需要测试？"></a>为什么我们需要测试？</h5><p>对于一些相对稳定的系统级别页面，自动化测试在提高测试的效率的方面起到非常重要的作用。前端的自动化测试主要包括：浏览器测试和单元测试。Vue官方脚手架自带自动化测试配置，并帮助你完成对组件，函数等的自动化测试，有利于持续集成。</p>
<h5 id="什么是持续集成？它和持续部署有什么区别？"><a href="#什么是持续集成？它和持续部署有什么区别？" class="headerlink" title="什么是持续集成？它和持续部署有什么区别？"></a>什么是持续集成？它和持续部署有什么区别？</h5><p>代码集成到主分支需要经过一系列的自动化测试，当测试都通过之后，方可执行自动化部署，否则不能完成集成。这说明了自动化测试的重要性，我们不能等测试工程师去发现问题。</p>
<p>在Vue脚手架当中，Karma和NightWatch分别对应着单元测试和e2e测试。单元测试更多是面向JS功能逻辑的检验，而NightWatch更多是面对业务逻辑的检验。</p>
<h4 id="unit测试"><a href="#unit测试" class="headerlink" title="unit测试"></a>unit测试</h4><p>代码的单元测试主要针对某些核心功能的某些函数进行测试。vue官方推荐是使用karma，mocha和chai等。karma并不是一个测试框架，也不是一个断言库。它可以运行HTTP Server，运行HTML文件在你喜欢的测试框架上。不仅仅只是运行测试，还可以计算测试的覆盖率。mocha是测试框架，专门实现各个单元划分测试。chai是典型的断言库。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/685800-c87db391f01ce563.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/602/format/webp" alt=""></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run unit # 运行单元测试</span><br></pre></td></tr></table></figure>
<h5 id="Karma"><a href="#Karma" class="headerlink" title="Karma"></a>Karma</h5><p>Karma是一个专门的测试运行器（runner），它不是测试框架，也不是断言库。Karma兼容Jasmine，Mocha和QUnit，可以集成mocha，webpack等功能，成为以Karma为平台的单元测试，官方选择的是mocha的测试框架和chai的断言库。它拥有一些测试插件：</p>
<ul>
<li>karma-webpack 用webpack预处理文件</li>
<li>karma-coverage 测试覆盖率，karma-coverage是基于istanbul。</li>
<li>karma-mocha 接入mocha测试框架</li>
<li>karma-spec-reporter 输出报告</li>
<li>karma-phantomjs-launcher 控制PhantomJS</li>
<li>karma-phantomjs-shim 给PhantomJS兼容的控制</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> webpackConfig = <span class="built_in">require</span>(<span class="string">'../../build/webpack.test.conf'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config.set(&#123;</span><br><span class="line">    browsers: [<span class="string">'PhantomJS'</span>], <span class="comment">// 测试服务浏览器</span></span><br><span class="line">    frameworks: [<span class="string">'mocha'</span>, <span class="string">'sinon-chai'</span>, <span class="string">'phantomjs-shim'</span>], <span class="comment">// 测试框架</span></span><br><span class="line">    reporters: [<span class="string">'spec'</span>, <span class="string">'coverage'</span>], <span class="comment">// 报告输出</span></span><br><span class="line">    files: [<span class="string">'./index.js'</span>], <span class="comment">// 文件入口，过滤掉index.html</span></span><br><span class="line">    preprocessors: &#123;</span><br><span class="line">      <span class="string">'./index.js'</span>: [<span class="string">'webpack'</span>, <span class="string">'sourcemap'</span>] <span class="comment">// 预处理器</span></span><br><span class="line">    &#125;,</span><br><span class="line">    webpack: webpackConfig, <span class="comment">// 专门测试webpack配置</span></span><br><span class="line">    webpackMiddleware: &#123;</span><br><span class="line">      noInfo: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    coverageReporter: &#123;</span><br><span class="line">      dir: <span class="string">'./coverage'</span>, <span class="comment">// 覆盖率配置</span></span><br><span class="line">      reporters: [</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">'lcov'</span>, <span class="attr">subdir</span>: <span class="string">'.'</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">type</span>: <span class="string">'text-summary'</span> &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="Mocha"><a href="#Mocha" class="headerlink" title="Mocha"></a>Mocha</h5><p>mocha本身只是一个单元测试框架，可以兼容第三方断言库，包括：</p>
<ul>
<li><a href="https://github.com/shouldjs/should.js" target="_blank" rel="noopener">should.js</a></li>
<li><a href="https://github.com/Automattic/expect.js" target="_blank" rel="noopener">expect.js</a></li>
<li><a href="https://www.chaijs.com/" target="_blank" rel="noopener">chai</a></li>
<li><a href="https://github.com/tj/better-assert" target="_blank" rel="noopener">better-assert</a></li>
<li><a href="http://unexpected.js.org/" target="_blank" rel="noopener">unexpected</a></li>
</ul>
<p>在Vue开发框架中位于specs（specifications）文件底下，可以针对某个组件或者某个js进行测试。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span>;</span><br><span class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">'@/components/Hello'</span>;</span><br><span class="line"></span><br><span class="line">describe(<span class="string">'Hello.vue'</span>, () =&gt; &#123;</span><br><span class="line">  it(<span class="string">'should render correct contents'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> Constructor = Vue.extend(Hello);</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Constructor().$mount();</span><br><span class="line">    expect(vm.$el.querySelector(<span class="string">'.hello h1'</span>).textContent)</span><br><span class="line">      .to.equal(<span class="string">'Welcome to Your Vue.js App'</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>其中，<code>describe</code>和<code>it</code>是<code>mocha</code>的语法结构，<code>describe</code>是这对某个组件或者函数的名字描述，测试脚本里面应该包括一个或多个<code>describe</code>块，每个<code>describe</code>块应该包括一个或多个<code>it</code>块。<code>it</code>是对它需要完成某些功能的描述，它里面是具体的测试用例。在测试框架中，<code>describe</code>,<code>it</code>, <code>expect</code>和<code>sinon</code>都是全局方法。</p>
<h5 id="Chai"><a href="#Chai" class="headerlink" title="Chai"></a>Chai</h5><p>Chai也就是一个非常简单的断言库，所谓的断言，就是预期某些执行结果符合你自己的要求。所有的测试用例都应该含有一句或多句的断言。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">expect(vm.$el.querySelector(<span class="string">'.hello h1'</span>).textContent)</span><br><span class="line">      .to.equal(<span class="string">'Welcome to Your Vue.js App'</span>);</span><br></pre></td></tr></table></figure>
<p>上面这句话的含义，就是在实例化了Hello这个组件之后，针对它某个dom上绑定的文字进行断言，保证了数据绑定后的文字显示。同理，也可以使用在某些js实现某个功能，对它进行自动化测试。</p>
<p>上面的测试用例中, 以<code>expect()</code>方法开头的就是断言.</p>
<p>所谓断言, 就是判断源码的实际执行结果与预期结果是否一致, 如果不一致, 就会抛出错误. 上面的断言的意思是指: 有<code>.num</code>这类名的节点的内容应该为数字<code>1</code>. 断言库库有很多种, <code>Mocha</code>并不限制你需要使用哪一种断言库, Vue的脚手架提供的断言库是<code>sino-chai,</code> 是一个基于<code>Chai</code>的断言库, 并且我们指定使用的是它的<code>expect</code>断言风格.</p>
<p><code>expect</code>断言风格的优点很接近于自然语言, 下面是一些例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 相等或不相等</span></span><br><span class="line">  expect(<span class="number">1</span> + <span class="number">1</span>).to.be.equal(<span class="number">2</span>);</span><br><span class="line">  expect(<span class="number">1</span> + <span class="number">1</span>).to.be.not.equal(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 布尔值为true</span></span><br><span class="line">  expect(<span class="string">'hello'</span>).to.be.ok;</span><br><span class="line">  expect(<span class="literal">false</span>).to.not.be.ok;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// typeof</span></span><br><span class="line">  expect(<span class="string">'test'</span>).to.be.a(<span class="string">'string'</span>);</span><br><span class="line">  expect(&#123; <span class="attr">foo</span>: <span class="string">'bar'</span> &#125;).to.be.an(<span class="string">'object'</span>);</span><br><span class="line">  expect(foo).to.be.an.instanceof(Foo);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// include</span></span><br><span class="line">  expect([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]).to.include(<span class="number">2</span>);</span><br><span class="line">  expect(<span class="string">'foobar'</span>).to.contain(<span class="string">'foo'</span>);</span><br><span class="line">  expect(&#123; <span class="attr">foo</span>: <span class="string">'bar'</span>, <span class="attr">hello</span>: <span class="string">'universe'</span> &#125;).to.include.keys(<span class="string">'foo'</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// empty</span></span><br><span class="line">  expect([]).to.be.empty;</span><br><span class="line">  expect(<span class="string">''</span>).to.be.empty;</span><br><span class="line">  expect(&#123;&#125;).to.be.empty;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// match</span></span><br><span class="line">  expect(<span class="string">'foobar'</span>).to.match(<span class="regexp">/^foo/</span>);</span><br></pre></td></tr></table></figure>
<p>每一个<code>it()</code>所包裹的测试用例都应该有一句或多句断言,上面只是介绍了一部分的断言语法, 如果想要知道更多<code>Chai</code>的断言语法, 请查看以下的官方文档.</p>
<blockquote>
<p>Chai官方文档: <a href="http://chaijs.com/" target="_blank" rel="noopener">http://chaijs.com/</a></p>
</blockquote>
<h5 id="vue-test-utils"><a href="#vue-test-utils" class="headerlink" title="vue-test-utils"></a>vue-test-utils</h5><p><a href="https://github.com/vuejs/vue-test-utils" target="_blank" rel="noopener">vuejs/vue-test-utils</a>是官方的辅助测试库。它其实即是将组件实例化的过程进行封装，帮你模拟它组件实例化过程。<code>shallow</code>这个函数把组件<code>List</code>实例化，并传入<code>props</code>等参数，这样，你可以断言数据绑定的结果。</p>
<p>下面我将在<code>Counter.spec.j</code>s测试脚本中对<code>Counter.vue</code>中<code>&lt;h3&gt;</code>的文本内容进行测试, 大家可以直观的感受一下使用了<code>Vue-test-utils</code>后对<code>.vue</code>单文件组件的测试变得多么简单.</p>
<ul>
<li>未使用vue-test-utils的测试用例:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'未使用Vue-test-utils: 正确渲染h3的文字为Counter.vue'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> Constructor = Vue.extend(Counter);</span><br><span class="line">    <span class="keyword">const</span> vm = <span class="keyword">new</span> Constructor().$mount();</span><br><span class="line">    <span class="keyword">const</span> H3 = vm.$el.querySelector(<span class="string">'h3'</span>).textContent;</span><br><span class="line">    expect(H3).to.equal(<span class="string">'Counter.vue'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>使用了vue-test-utils的测试用例:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">it(<span class="string">'使用Vue-test-Utils: 正确渲染h3的文字为Counter.vue'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = mount(Counter);</span><br><span class="line">    expect(wrapper.find(<span class="string">'h3'</span>).text()).to.equal(<span class="string">'Counter.vue'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>从上面的代码可以看出, <code>vue-test-utils</code>工具将该测试用例的代码量减少了一半, 如果是更复杂的测试用例, 那么代码量的减少将更为突出. 它可以让我们更专注于去写文件的测试逻辑, 将获取组件实例和挂载的繁琐的操作交由<code>vue-test-utils</code>去完成.</p>
<p>常用api：</p>
<ul>
<li><code>find()</code>: 返回匹配选择器的第一个DOM节点或Vue组件的wrapper, 可以使用任何有效的选择器</li>
<li><code>text()</code>: 返回wrapper的文本内容</li>
<li><code>html()</code>: 返回wrapper DOM的HTML字符串</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">it(<span class="string">'find()/text()/html()方法'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = mount(Counter);</span><br><span class="line">    <span class="keyword">const</span> h3 = wrapper.find(<span class="string">'h3'</span>);</span><br><span class="line">    expect(h3.text()).to.equal(<span class="string">'Counter.vue'</span>);</span><br><span class="line">    expect(h3.html()).to.equal(<span class="string">'&lt;h3&gt;Counter.vue&lt;/h3&gt;'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>trigger()</code>: 在该 wrapper DOM 节点上触发一个事件。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'trigger()方法'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = mount(Counter);</span><br><span class="line">    <span class="keyword">const</span> buttonOfSync = wrapper.find(<span class="string">'.sync-button'</span>);</span><br><span class="line">    buttonOfSync.trigger(<span class="string">'click'</span>);</span><br><span class="line">    buttonOfSync.trigger(<span class="string">'click'</span>);</span><br><span class="line">    <span class="keyword">const</span> count = <span class="built_in">Number</span>(wrapper.find(<span class="string">'.num'</span>).text());</span><br><span class="line">    expect(count).to.equal(<span class="number">2</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><code>setData()</code>: 设置data的属性并强制更新</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">it(<span class="string">'setData()方法'</span>,() =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = mount(Counter);</span><br><span class="line">    wrapper.setData(&#123;<span class="attr">foo</span>: <span class="string">'bar'</span>&#125;);</span><br><span class="line">    expect(wrapper.vm.foo).to.equal(<span class="string">'bar'</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h6 id="伪造组件参数"><a href="#伪造组件参数" class="headerlink" title="伪造组件参数"></a>伪造组件参数</h6><p>有的时候你想要测试一个组件在配合 props 对象的参数时的行为。这时候你可以传递自定义假数据给 Vue 实例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = shallowMount(HelloWorld, &#123;</span><br><span class="line">    propsData: &#123;</span><br><span class="line">        test: <span class="string">'Test case'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">expect(wrapper.props().test).to.equal(<span class="string">'Test case'</span>)</span><br></pre></td></tr></table></figure>
<h6 id="伪造-route-和-router"><a href="#伪造-route-和-router" class="headerlink" title="伪造 $route 和 $router"></a>伪造 <code>$route</code> 和 <code>$router</code></h6><p>有的时候你想要测试一个组件在配合 $route 和 $router 对象的参数时的行为。这时候你可以传递自定义假数据给 Vue 实例。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; shallowMount &#125; <span class="keyword">from</span> <span class="string">'@vue/test-utils'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> $route = &#123;</span><br><span class="line">  path: <span class="string">'/some/path'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wrapper = shallowMount(Component, &#123;</span><br><span class="line">  mocks: &#123;</span><br><span class="line">    $route</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">wrapper.vm.$route.path <span class="comment">// /some/path</span></span><br></pre></td></tr></table></figure>
<p>常识：</p>
<p>安装 <code>Vue Router</code> 会在 <code>Vue</code> 的原型上添加 <code>$route</code> 和 <code>$router</code> 只读属性。</p>
<p>这意味着在未来的任何测试中，伪造 <code>$route</code> 或 <code>$router</code> 都会失效。</p>
<p>要想回避这个问题，就不要在运行测试的时候全局安装 <code>Vue Router</code>。</p>
<p>上面介绍了几个vue-test-utils提供的方法, 如果想深入学习vue-test-utils, 请阅读下面的官方文档:</p>
<blockquote>
<p><code>vue-test-utils</code>官方文档：<a href="https://vue-test-utils.vuejs.org/zh-cn/" target="_blank" rel="noopener">https://vue-test-utils.vuejs.org/zh-cn/</a></p>
</blockquote>
<h4 id="e2e测试"><a href="#e2e测试" class="headerlink" title="e2e测试"></a>e2e测试</h4><p>单元测试更多是对某个组件或者js进行功能测试。端对端测试（e2e）用于模拟整个业务流程的进行自动化测试（填报，增删查改等）。vue官方推荐是使用<a href="https://link.jianshu.com?t=http%3A%2F%2Fnightwatchjs.org%2F" target="_blank" rel="noopener">nightwatch</a>，它同样只是个runner，默认配置chromedriver，phantomjs。</p>
<h5 id="NightWatch"><a href="#NightWatch" class="headerlink" title="NightWatch"></a>NightWatch</h5><p>NightWatch是一个专门的端对端测试运行器（runner），它的配置文件nightwatch.conf.js会设置对应的命令参数，拼接到nightwatch的命令行操作，详情参考<a href="https://link.jianshu.com?t=http%3A%2F%2Fnightwatchjs.org%2F" target="_blank" rel="noopener">官网</a>。</p>
<p>它依赖于浏览器控制器selenium，而selenium是一个基于java的项目，需要java的运行环境。所以你需要安装sdk版本大于1.8并配置好环境变量。然而，selenium需要对应的webDriver配合来操控浏览器。</p>
<h5 id="执行测试"><a href="#执行测试" class="headerlink" title="执行测试"></a>执行测试</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="string">'default e2e tests'</span>: <span class="function"><span class="keyword">function</span> (<span class="params">browser</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> devServer = browser.globals.devServerURL</span><br><span class="line">    browser.url(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(result);</span><br><span class="line">    &#125;);</span><br><span class="line">    browser.expect.element(<span class="string">'body'</span>).to.be.present</span><br><span class="line">    browser</span><br><span class="line">      .url(devServer)</span><br><span class="line">      .waitForElementVisible(<span class="string">'#app'</span>, <span class="number">5000</span>)</span><br><span class="line">      .assert.attributeEquals(<span class="string">'body'</span>, <span class="string">'data-attr'</span>, <span class="string">'xiaopili'</span>)</span><br><span class="line">      .assert.cssProperty(<span class="string">'body'</span>, <span class="string">'display'</span>, <span class="string">'block'</span>)</span><br><span class="line">      .waitForElementNotPresent(<span class="string">'#dialog'</span>, <span class="number">1000</span>)</span><br><span class="line">      .end()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>综上所述，e2e测试的写法很简单，它相较于单元测试得功能检验，更多是浏览器外的控制，针对某些业务流程进行浏览器的操作验证。以前测试工程师要花十分钟完成的“测试流程”，我们可以快速得模拟出来。</p>
<h2 id="四、nodejs接口自动化测试实例"><a href="#四、nodejs接口自动化测试实例" class="headerlink" title="四、nodejs接口自动化测试实例"></a>四、nodejs接口自动化测试实例</h2><h3 id="原料"><a href="#原料" class="headerlink" title="原料"></a>原料</h3><ul>
<li><a href="https://mochajs.org/" target="_blank" rel="noopener">mocha</a></li>
<li><a href="https://www.npmjs.com/package/supertest" target="_blank" rel="noopener">supertest</a></li>
<li><a href="https://eggjs.org/zh-cn/intro/" target="_blank" rel="noopener">egg.js</a></li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><ul>
<li>全局安装<code>Mocha</code>或者安装到具体项目</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --global mocha</span><br></pre></td></tr></table></figure>
<ul>
<li><p>在需要自动化测试的项目中建立文件夹test或者单独建立项目的对应自动化测试仓库</p>
</li>
<li><p>编写测试用例</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> assert = <span class="built_in">require</span>(<span class="string">'assert'</span>);</span><br><span class="line">describe(<span class="string">'Array'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  describe(<span class="string">'#indexOf()'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">'should return -1 when the value is not present'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      assert.equal(<span class="number">-1</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].indexOf(<span class="number">4</span>));</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">在命令行输入`</span>mocha test.js<span class="string">`</span></span><br><span class="line"><span class="string">结果如下：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span> js</span><br><span class="line"><span class="built_in">Array</span></span><br><span class="line">    #indexOf()</span><br><span class="line">      ✓ should <span class="keyword">return</span> <span class="number">-1</span> when the value is not present</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="number">1</span> passing (<span class="number">9</span>ms)</span><br></pre></td></tr></table></figure>
<p><code>describe</code>函数可以使结果分组展示，可以多级嵌套</p>
<h3 id="进行接口测试"><a href="#进行接口测试" class="headerlink" title="进行接口测试"></a>进行接口测试</h3><p>我们比较关注的是接口是否可以正常使用。这里我们可以引入模块<a href="https://www.npmjs.com/package/supertest" target="_blank" rel="noopener">supertest</a>进行接口测试<br>例子如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> request = <span class="built_in">require</span>(<span class="string">'supertest'</span>);</span><br><span class="line">describe(<span class="string">'GET /'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  it(<span class="string">'respond with json'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">done</span>) </span>&#123;</span><br><span class="line">    request(<span class="string">'http://127.0.0.1:7002'</span>)</span><br><span class="line">      .get(<span class="string">'/'</span>)</span><br><span class="line">      .set(<span class="string">'Accept'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">      .expect(<span class="string">'Content-Type'</span>, /json/)</span><br><span class="line">      .expect(&#123;</span><br><span class="line">          code: <span class="number">200</span>,</span><br><span class="line">          msg: <span class="string">'hi, egg'</span></span><br><span class="line">      &#125;, done);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">describe(<span class="string">'GET /detail'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    it(<span class="string">'respond with json'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">done</span>) </span>&#123;</span><br><span class="line">      request(<span class="string">'http://127.0.0.1:7002'</span>)</span><br><span class="line">        .get(<span class="string">'/detail'</span>)</span><br><span class="line">        .set(<span class="string">'Accept'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">        .expect(<span class="string">'Content-Type'</span>, /json/)</span><br><span class="line">        .expect(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!(<span class="string">'code'</span> <span class="keyword">in</span> res.body)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"missing code key"</span>);</span><br><span class="line">            <span class="keyword">if</span> (!(<span class="string">'msg'</span> <span class="keyword">in</span> res.body)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"missing msg key"</span>);</span><br><span class="line">            <span class="keyword">if</span> (!(res.body.msg == <span class="string">'description...'</span>)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"msg is wrong"</span>)</span><br><span class="line">          &#125;)</span><br><span class="line">        .end(done);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>describe</code>分组一中我们向<code>http://localhost:7002</code>这个端口发送请求访问<code>/</code>路径，并且断言返回头有<code>&#39;Content-Type&#39;</code>, <code>/json/</code>，返回结果为以下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    code: <span class="number">200</span>,</span><br><span class="line">    msg: <span class="string">'hi, egg'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>describe</code>分组一中我们向<code>http://localhost:7002</code>这个端口发送请求访问<code>/detail</code>路径，并且断言返回头有<code>&#39;Content-Type&#39;</code>, <code>/json/</code>，返回结果中必须包含字段<code>code</code>和<code>msg</code>且<code>msg</code>字段的内容必须为<code>description...</code></p>
<p>这里注意 <code>function(done)</code>中的<code>done</code>不能省略，这个是<code>mocha</code>中的异步回调，<code>done</code>在调用后表示异步结束，只能调用一次，如果调用<code>done()</code>表示成功结束，如果是<code>done(err)</code>表示失败，控制台会打印<code>err</code>的信息</p>
<p>运行<code>mocha index.js</code>，成功结果如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">GET /</span><br><span class="line">  ✓ respond <span class="keyword">with</span> json (<span class="number">135</span>ms)</span><br><span class="line"></span><br><span class="line">GET /detail</span><br><span class="line">  ✓ respond <span class="keyword">with</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">2</span> passing (<span class="number">160</span>ms)</span><br></pre></td></tr></table></figure>
<p>运行错误结果如下(返回括号内的错误信息)：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /</span><br><span class="line">    ✓ respond <span class="keyword">with</span> json</span><br><span class="line"></span><br><span class="line">GET /detail</span><br><span class="line">    <span class="number">1</span>) respond <span class="keyword">with</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">1</span> passing (<span class="number">61</span>ms)</span><br><span class="line"><span class="number">1</span> failing</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>) GET /detail</span><br><span class="line">    respond <span class="keyword">with</span> json:</span><br><span class="line">    <span class="built_in">Error</span>: msg is wrong</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/01/refresher组件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiao.liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/14329197?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaopili's Blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/01/refresher组件/" itemprop="url">refresher组件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-01T17:12:55+08:00">
                2017-02-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fe组件类/" itemprop="url" rel="index">
                    <span itemprop="name">fe组件类</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="基于iscroll的下拉刷新上拉加载"><a href="#基于iscroll的下拉刷新上拉加载" class="headerlink" title="基于iscroll的下拉刷新上拉加载"></a>基于iscroll的下拉刷新上拉加载</h3><p>链接地址： <a href="https://github.com/xiaopili/refresher" target="_blank" rel="noopener">refresher</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">var</span> ref = <span class="keyword">new</span> refresher(&#123;</span><br><span class="line">    id:<span class="string">"wrapper"</span>,               <span class="comment">//需要注册插件的元素（内部需直接包含ul li）</span></span><br><span class="line">	pullDownAction:Refresh,     <span class="comment">//下拉刷新的回调(可不传，则不显示效果)                                                       </span></span><br><span class="line">	pullUpAction:Load,          <span class="comment">//上拉加载的回调</span></span><br><span class="line">	topDistance:<span class="number">1.173333</span>,       <span class="comment">//顶部插入元素的高度和</span></span><br><span class="line">	info: &#123;</span><br><span class="line">		<span class="string">"pullDownLable"</span>: <span class="string">"下拉刷新..."</span>, </span><br><span class="line">		<span class="string">"pullingDownLable"</span>: <span class="string">"放开刷新..."</span>,</span><br><span class="line">		<span class="string">"pullUpLable"</span>: <span class="string">"上拉加载更多..."</span>,</span><br><span class="line">		<span class="string">"pullingUpLable"</span>: <span class="string">"放开加载更多..."</span>,</span><br><span class="line">		<span class="string">"loadingLable"</span>: <span class="string">"正在加载..."</span></span><br><span class="line">	&#125; 																			</span><br><span class="line">&#125;)																																					</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Refresh</span>(<span class="params"></span>) </span>&#123;																</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		alert(<span class="string">'23333'</span>);																					 </span><br><span class="line">		ref.wrapper.refresh(); <span class="comment">//对象名称为id   //清除动作（主意wrapper为注册的元素）</span></span><br><span class="line">	&#125;, <span class="number">800</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Load</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		alert(<span class="string">'23333'</span>)</span><br><span class="line">		ref.wrapper.refresh(); <span class="comment">//对象名称为id   //清除动作</span></span><br><span class="line">		ref.noMore(<span class="string">'没有更多了...'</span>);</span><br><span class="line">	&#125;, <span class="number">800</span>);	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/05/xhc前端规范/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="xiao.liang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars1.githubusercontent.com/u/14329197?s=460&v=4">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaopili's Blogs">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/05/xhc前端规范/" itemprop="url">xhc前端规范</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-05T14:29:19+08:00">
                2016-12-05
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/fe部署流程/" itemprop="url" rel="index">
                    <span itemprop="name">fe部署流程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="小红唇前端规范"><a href="#小红唇前端规范" class="headerlink" title="小红唇前端规范"></a>小红唇前端规范</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li>Git仓库</li>
<li>目录结构</li>
<li>环境说明</li>
<li>App的发布</li>
<li>活动页的自动生成</li>
<li>前端框架</li>
<li>Sass公共库</li>
<li>自动化</li>
<li>自建接口</li>
<li>知识库</li>
</ul>
<hr>
<h2 id="Git仓库"><a href="#Git仓库" class="headerlink" title="Git仓库"></a>Git仓库</h2><pre><code>Git仓库地址：
    SSH root@192.168.1.16:kevintang/newfe.git
    HTTP http://192.168.1.16:3000/kevintang/newfe.git
    控制台 http://192.168.1.16:3000/KevinTang/newFE
</code></pre><p>注意：以上的192.168.1.16服务器需要连接VPN后才可以访问，需要使用openVPN</p>
<hr>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>前端环境中，以APP为一个最小的管理单元，每一个APP独占一个文件夹，文件夹名即为APP名。例如商城需求，则应将商城的所有文件（包括html,js,css,image,font等文件放）置在一个文件夹中，命名为store，但公共库不放在其中，公共库放置在与APP统计的lib目录中，所以整体的目录结构如下：</p>
<pre><code>├─lib                       公共库文件夹
│  ├─css                    公共css文件
│  ├─assets                 公共拦截文件
│  ├─fonts                  公共字体文件
│  └─*.js                   公共js库文件
├─{App}                     App文件夹，例如商城，文件夹名为store
│  ├─scss =&gt; *.scss         App内scss文件夹，将被已相同文件名编译至css目录下
│  ├─css  =&gt; *.css          App内css文件夹
│  ├─js   =&gt; *.js           App内js文件夹，要求每个页面只有一个脚本文件
│  └─images                 图片文件夹
├─package.json              npm依赖包列表
└─gulpfile.js               gulp自动化脚本
</code></pre><h3 id="具体说明"><a href="#具体说明" class="headerlink" title="具体说明"></a>具体说明</h3><p><strong>lib/</strong> 所有前端页面的公共类库，复用最为广泛的文件应当放至在该文件夹内，且该文件夹内原则上只允许放至压缩过的文件，对于js要求是uglify过的混淆文件，对于css文件原则上要求是经过cssmin的压缩，但有可能产生问题的css文件可以不压缩。公共库的所有js文件直接放在lib目录下</p>
<p><strong>lib/assets/</strong> 所有需要被客户端拦截的文件放至在这里，例如jquert.2.1.4.min.js，用于判断页面是否在APP内运行</p>
<p><strong>lib/fonts/</strong> 公共字体文件，原则上用到的特殊字体或者Icon字体全部放至在该文件夹内，APP内的文件夹中不放置字体文件</p>
<p><strong>{App}/</strong> APP中所有的页面文件，原则上只存储html文件</p>
<p><strong>{App}/scss/</strong> APP内的scss文件夹，所有的scss文件将会以同名被编译至css文件夹中，例如scss/list.scss文件将被编译到css/list.css</p>
<p><strong>{App}/css/</strong> APP内的css文件夹，原则上这个文件夹不手工创建任何文件，而是全部来自scss文件夹编译而来的文件</p>
<p><strong>{App}/js/</strong> APP内的js文件夹，每个页面原则上只拥有一个js文件，且与页面html文件同名，每个APP拥有一个公共的库文件，也存于本文件夹下，与APP名相同，例如：商城功能中又有一个商品列表页面，页面名为list.html，则页面中除去公共库lib目录中的引用外，至多再可引用两个文件：js/list.js和js/store.js</p>
<p><strong>{App}/images/</strong> APP中所有的图片资源文件</p>
<hr>
<h2 id="环境说明"><a href="#环境说明" class="headerlink" title="环境说明"></a>环境说明</h2><p>前端所有页面要求在本地编码完成后，提交到本地测试环境进行测试，然后提交到七牛预演环境进行测试，最终提交到生产环境。</p>
<h3 id="本地编码环境"><a href="#本地编码环境" class="headerlink" title="本地编码环境"></a>本地编码环境</h3><p>本地编码环境是指开发者在本地自行搭建的临时测试环境，用于在编码过程中进行各种测试。但由于域名限制的问题，一些功能（例如微信登陆、微信JSSDK、微信支付、支付宝支付）等功能需要提交到预演环境进行测试。</p>
<p>在开始编码前，请确认计算机上的node版本大于4.0，因为gulp脚本中使用了大量ES6特性</p>
<p>开发者需要首先克隆Git仓库，然后安装node包依赖，可以使用以下命令进行安装：</p>
<pre><code>npm install
</code></pre><p>注意：gulp-sass插件安装较慢，请耐心等待</p>
<p>之后，需要全局安装gulp：</p>
<pre><code>npm install gulp -g
</code></pre><p>安装成功后，可以使用以下命令检查</p>
<pre><code>gulp check
</code></pre><p>当在console中显示出Install OK表示安装正常，否则请检查依赖包是否安装完整</p>
<h4 id="本地环境的搭建"><a href="#本地环境的搭建" class="headerlink" title="本地环境的搭建"></a>本地环境的搭建</h4><p>首选需要明确要调试的APP，然后执行以下命令：</p>
<pre><code>gulp --app :appname [--port :port]
</code></pre><p>其中appname为要调试的App名，port为指定本地服务器的端口，默认80端口<br>默认绑定的IP地址为0.0.0.0，即全部IP</p>
<hr>
<h3 id="本地测试环境"><a href="#本地测试环境" class="headerlink" title="本地测试环境"></a>本地测试环境</h3><p>本地测试环境使用一台基于ARM架构的嵌入式系统构建，使用Nginx作为Web服务器，每次从Git仓库拉取最新代码以进行调试。</p>
<p>服务器具体参数：</p>
<pre><code>地址：          192.168.2.200:81    (需要连接到内网主路由器，包括：XHC, xhc-5G-1, xhc-5G-2)
服务器配置文件: /etc/nginx/sites-enabled/testenv
测试文件位置：  /home/git/FETest/
</code></pre><p>要把代码部署到本地测试环境，需要先将代码提交到Git仓库，并推送到远程仓库，然后执行以下命令：</p>
<pre><code>gulp --app :appname test
</code></pre><p>上述代码是触发服务器的git pull命令以拉取远端Git库中的最新代码，如未检测到任何变动，将会产生一下错误：</p>
<pre><code>Warning: Nothing update!
</code></pre><p>此时请确认代码已经正确提交到远程Git仓库，或本地服务器已经是代码的最新版本。<br>当本地测试服务器无响应时，将产生以下错误：</p>
<pre><code>Can not connect to Local Test Server ...
</code></pre><p><strong>注意</strong> 部署到本地测试环境时，不需要指定App，Git仓库中的所有更新都将被部署到服务器上，不需要单独部署公共库Lib文件夹。部署到本地测试环境的所有代码都是原始的，未经任何压缩的。</p>
<hr>
<h3 id="预演环境"><a href="#预演环境" class="headerlink" title="预演环境"></a>预演环境</h3><p>预演环境是架设在七牛云存储上的一个独立空间，由于很多功能模块对域名有限制，所以预演环境能更好的测试一些在本地测试环境中无法测试的功能。</p>
<p>服务器具体参数：</p>
<pre><code>域名：          http://fetest.xiaohongchun.com
空间(bucket)：  fetest
</code></pre><p>要把代码部署到预演环境上，可以执行以下命令：</p>
<pre><code>gulp --app :appname [--cssmin] preview
</code></pre><p>上述代码会首先将指定App中的代码进行发布，有关发布的内容请见 <strong>App的发布</strong> 一节<br>发布后的代码将会上传至七牛的对应空间中，使用对应域名可以进行访问，在上传过程中，将会跳过那些没有改动的文件</p>
<p><strong>注意</strong> 只执行preview指令只会部署app文件夹中的所有文件，而不会部署lib文件夹中的公共库<br>要部署lib文件夹中的文件，可以执行如下命令：</p>
<pre><code>gulp preview-lib
</code></pre><hr>
<h3 id="生产环境"><a href="#生产环境" class="headerlink" title="生产环境"></a>生产环境</h3><p>生产环境是线上版本，最终展示给用户的，上线前请再三确认</p>
<p>服务器具体参数：</p>
<pre><code>域名：          http://static.xiaohongchun.com
空间(bucket)：  xhc-static
</code></pre><p>要把代码部署到预演环境上，可以执行以下命令：</p>
<pre><code>gulp --app :appname [--cssmin] product
</code></pre><p>上述代码会首先将指定App中的代码进行发布，有关发布的内容请见 <strong>App的发布</strong> 一节<br>发布后的代码将会上传至七牛的对应空间中，使用对应域名可以进行访问，在上传过程中，将会跳过那些没有改动的文件</p>
<p><strong>注意</strong> 只执行preview指令只会部署app文件夹中的所有文件，而不会部署lib文件夹中的公共库<br>要部署lib文件夹中的文件，可以执行如下命令：</p>
<pre><code>gulp product-lib
</code></pre><hr>
<h2 id="App的发布"><a href="#App的发布" class="headerlink" title="App的发布"></a>App的发布</h2><p>App的发布是至将某个App文件夹中的代码文件进行一些处理之后，放在./../publish/目录下的过程，是发布到预演环境和生产环境的先导步骤。</p>
<p>这些处理包括：</p>
<ul>
<li>js文件压缩混淆</li>
<li>css文件压缩（默认不开启，如需要使用，需要在gulp命令中加入–cssmin指令）</li>
<li>html中引用的js和css文件加入版本控制，具体做法是在文件名后加入 <strong>?v={时间戳}</strong> ，但用于供APP截获的文件(lib\assets\文件夹中的文件)不会被加入版本控制</li>
</ul>
<p>要使用App发布，可以使用以下命令：</p>
<pre><code>gulp --app :appname [--cssmin] publish
</code></pre><p><strong>注意</strong> 只运行publish任务，不会发布公共库lib目录，要发布lib目录，可以使用以下命令：</p>
<pre><code>gulp publish-lib
</code></pre><p>上述命令会将lib目录下的js文件进行压缩混淆，而其他文件原样复制到./../publish/lib/</p>
<hr>
<h2 id="活动页的自动生成"><a href="#活动页的自动生成" class="headerlink" title="活动页的自动生成"></a>活动页的自动生成</h2><p>为了应对频繁且相似度高的运营活动页面的制作问题，可以使用gulp自动化工具进行制作，步骤如下：</p>
<h4 id="切图"><a href="#切图" class="headerlink" title="切图"></a>切图</h4><p>请使用相关切图工具对设计长图进行切分，原则上一个区块切分为一个切片，且单个切片高度不大于500px</p>
<p>切好的图片，按照以下命名格式存储在 <strong>active/images/</strong> 目录中</p>
<pre><code>{ActiveName}_{ID}.png
</code></pre><p>{ActiveName}为活动名称，纯英文，多单词时使用驼峰命名法，例如空瓶活动：emptyBottle<br>{ID}切片编号，当切片数量小于10时，直接采用一位数字，其他情况在数字前补0保持位数相同</p>
<h4 id="微信分享文案准备"><a href="#微信分享文案准备" class="headerlink" title="微信分享文案准备"></a>微信分享文案准备</h4><p>请准备好以下三个内容：</p>
<ul>
<li>微信分享标题</li>
<li>微信分享文案</li>
<li>微信分享小图</li>
</ul>
<p>微信分享小图请按照以下文件名存储在 <strong>active/images/</strong> 目录中</p>
<pre><code>weChatIcon_{ActiveName}.png
</code></pre><h4 id="gulp生成页面"><a href="#gulp生成页面" class="headerlink" title="gulp生成页面"></a>gulp生成页面</h4><p>执行以下命令，可以根据 active/template.html 文件为模板生成一个新的活动页面</p>
<pre><code>gulp active
</code></pre><p>执行上述命令后，将出现以下提示：</p>
<pre><code>**Active Name (FileName)** 活动名，将作为文件名
**Page Image Num** 活动页面中的图片的切片数量
**Share Title** 微信分享标题
**Share Content** 微信分享文案
</code></pre><p>所有参数输入之后，将生成**active/{ActiveName}.html文件</p>
<p>随后可以执行以下命令，将刚刚生成好的活动页面部署到生产环境</p>
<pre><code>gulp --app active product
</code></pre><hr>
<h2 id="前端框架"><a href="#前端框架" class="headerlink" title="前端框架"></a>前端框架</h2><p>目前使用的公共前端框架有：</p>
<ul>
<li><a href="http://cn.vuejs.org/api/" target="_blank" rel="noopener">Vue</a></li>
<li><a href="http://www.css88.com/jqapi-1.9/" target="_blank" rel="noopener">jQuery</a></li>
</ul>
<p>自用的公共库(lib\mobile.js)：</p>
<pre><code>在页面中使用mobile库，可以使用mobile.方法名的形式进行调用
mobile.js 中已经集成了jQuery1.9.1、MediaElement.js、MediaElementPlayer、bShare组件
</code></pre><p>mobile.js方法列表：</p>
<ul>
<li><p><strong>binddownload</strong> (jquery_selector)<br>  <strong>方法</strong>    在指定的DOM上绑定下载APP的事件，微信中跳转应用宝，安卓直接下载APK文件，苹果跳转iTunes<br>  <strong>参数</strong>    jquery_selector 数组 jQuery选择器字符串<br>  <strong>示例</strong>    mobile.binddownload([‘.download’, ‘.footerdownload’,’.comment’])</p>
</li>
<li><p><strong>template</strong> (template, option)   废弃<br>  <strong>方法</strong>    一个简单的模版解释器</p>
</li>
<li><p><strong>limitless</strong> (height, callback)<br>  <strong>方法</strong>    用于进行无尽加载，当页面滚动至距离页面底端小于height像素时，出发callback，对于callback进行了200ms的函数节流<br>  <strong>参数</strong>    height 数字 触发阈值    callback 函数 回调函数</p>
</li>
<li><p><strong>query</strong> (item)<br>  <strong>函数</strong>    解析QueryString<br>  <strong>参数</strong>    item 字符串 要获取的字段<br>  <strong>示例</strong>    例如url为<a href="http://xhc.com/eg.html?a=1，调用mobile.query(&#39;a&#39;)返回&#39;1&#39;" target="_blank" rel="noopener">http://xhc.com/eg.html?a=1，调用mobile.query(&#39;a&#39;)返回&#39;1&#39;</a></p>
</li>
<li><p><strong>renderdom</strong> (dom, data, template, type)   废弃<br>  <strong>方法</strong>    template的二次封装，加入了更多的模版功能</p>
</li>
<li><p><strong>adddownloader</strong> (option)<br>  <strong>方法</strong>    在页面的上下加入小红唇APP下载条<br>  <strong>参数</strong>    option.position 可选值 both,top,bottom  option.height 可选值 上方占位Div的高度</p>
</li>
<li><p><strong>share.bind</strong> (item) 废弃<br>  <strong>方法</strong>    给指定DOM加入点击分享事件，调用bShare<br>  <strong>参数</strong>    item 数组 要绑定的jQuery选择器字符串</p>
</li>
<li><p><strong>videoplugin</strong> (size, selector, callback)<br>  <strong>方法</strong>    给指定的<video>标签加入视频播放空间<br>  <strong>参数</strong>    size 数字 正方形视频的宽高  selector 字符串 jQuery选择器字符串  callback 函数 成功加入播放控件后的回调函数</video></p>
</li>
<li><p><strong>notification</strong> (option)<br>  <strong>方法</strong>    显示一个半透明的提示框<br>  <strong>参数</strong>    {icon:图标URL，text:要显示的文本，position:出现位置(top-left,top-right,bottom-left,bottom-right)，duration:显示的时间，超时后消失，callback:消失后的回调函数}</p>
</li>
<li><p><strong>throttle</strong> (method, interval, context)<br>  <strong>方法</strong>    返回一个函数的节流版本<br>  <strong>参数</strong>    method 要被限制的函数   interval 节流的间隔时间 context 执行上下文</p>
</li>
<li><p><strong>scrolldown</strong> (callback(height))<br>  <strong>方法</strong>    当页面被下拉的时候触发回调，对回调函数做了200ms的函数节流<br>  <strong>参数</strong>    callback 回调函数   height 被下拉的距离</p>
</li>
<li><p><strong>avoidEmptyRequest</strong> ()<br>  <strong>方法</strong>    为了解决vue中image标签的src属性被预先置入占位符而导致的404问题<br>  <strong>用法</strong>    在所有的img标签中，用data-src属性替代原生的src属性，并在vue渲染完毕后，调用本方法</p>
</li>
<li><p><strong>weChat.initWeChat</strong> ()<br>  <strong>方法</strong>    向页面中注入微信JSSDK权限，需要保证已经引入了微信js库，并且调用域名为微信公众账号中的安全域名</p>
</li>
<li><p><strong>weChat.bindWeChatShare</strong> (option)<br>  <strong>方法</strong>    向微信浏览器中注入分享参数，用来控制微信分享消息中的内容<br>  <strong>注意</strong>    调用本方法前不需要调用initWeChat方法来注入权限，因为本方法会自行调用。本方法中的所有参数需要涉及URL时，可直接使用相对地址<br>  <strong>参数</strong>    <a href="http://mp.weixin.qq.com/wiki/7/1c97470084b73f8e224fe6d9bab1625b.html#.E8.8E.B7.E5.8F.96.E2.80.9C.E5.88.86.E4.BA.AB.E5.88.B0.E6.9C.8B.E5.8F.8B.E5.9C.88.E2.80.9D.E6.8C.89.E9.92.AE.E7.82.B9.E5.87.BB.E7.8A.B6.E6.80.81.E5.8F.8A.E8.87.AA.E5.AE.9A.E4.B9.89.E5.88.86.E4.BA.AB.E5.86.85.E5.AE.B9.E6.8E.A5.E5.8F.A3" target="_blank" rel="noopener">点击查看</a></p>
</li>
<li><p><strong>weChat.getCode</strong> (scope, state)<br>  <strong>函数</strong>    获取微信登录的临时凭票，如果当前页面没有临时凭票则会跳转到微信登陆界面<br>  <strong>参数</strong>    scope 可选 微信登陆作用域，有两个可选值snsapi_base（不可获取用户资料），snsapi_userinfo（可以获取用户资料）<br>state 可以被微信登录服务器传递的参数</p>
</li>
<li><p><strong>weChat.setToken</strong> (callback)<br>  <strong>方法</strong>  调用该方法后，将会使用ajaxSetup的形式向之后发生的所有AJAX请求中注入用户授权<br>  <strong>参数</strong>  callback 获取Token成功后回调，Token作为回调函数的参数返回</p>
</li>
<li><p><strong>appendBaiduAnalysis</strong> ()<br>  <strong>方法</strong>    加入百度统计代码，在活动页等需要统计访问的页面中需要调用本方法</p>
</li>
<li><p><strong>convertURL</strong> (url)<br>  <strong>函数</strong>    将相对地址转换为绝对地址，而绝对地址原样返回<br>  <strong>参数</strong>    要转换的URL</p>
</li>
<li><p><strong>appendAppShare</strong> (smallimage, content)<br>  <strong>方法</strong>    向APP内注入分享参数<br>  <strong>注意</strong>    在非小红唇APP中使用本方法无效，分享消息的标题为页面标题(document.title)<br>  <strong>原理</strong>    通过发起一个image类型的Http请求，APP进行截获获取参数<br>  <strong>参数</strong>    smallimage 分享小图 content 分享文字 </p>
</li>
<li><p><strong>domClick</strong> ()<br>  <strong>方法</strong>    给页面上带data-location属性的DOM加入当click时的location.href行为</p>
</li>
<li><p><strong>inApp</strong> ()<br>  <strong>函数</strong>    返回一个布尔值，指示当前页面是否是在小红唇APP的浏览器中打开的</p>
</li>
<li><strong>loadingComplete</strong> ()<br>  <strong>方法</strong>    加载完成后调用</li>
</ul>
<hr>
<h2 id="Sass公共库"><a href="#Sass公共库" class="headerlink" title="Sass公共库"></a>Sass公共库</h2><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p>要使用Sass公共库中的函数，需要在对应的Sass定义中按照如下格式进行调用</p>
<pre><code>@include 函数名(参数列表)
</code></pre><h3 id="函数列表"><a href="#函数列表" class="headerlink" title="函数列表"></a>函数列表</h3><h4 id="divcenter-height"><a href="#divcenter-height" class="headerlink" title="divcenter(height)"></a>divcenter(height)</h4><pre><code>height 盒高
给单行盒中的文字垂直居中
</code></pre><h4 id="fixed-position"><a href="#fixed-position" class="headerlink" title="fixed(position)"></a>fixed(position)</h4><pre><code>position [top, bottom] 位置
在页面中的左上角或左下角fix的显示一个元素
</code></pre><h4 id="gap-width"><a href="#gap-width" class="headerlink" title="gap(width)"></a>gap(width)</h4><pre><code>width 边框宽度
为一个盒加入下边框，需要提前设置 $bgcolor 变量
</code></pre><h4 id="bb-width-border-color"><a href="#bb-width-border-color" class="headerlink" title="bb(width, border_color)"></a>bb(width, border_color)</h4><pre><code>width 边框宽度
border_color 边框颜色
与上一个方法相同，颜色值以参数形式传入
</code></pre><h4 id="circle-size"><a href="#circle-size" class="headerlink" title="circle(size)"></a>circle(size)</h4><pre><code>size 圆环直径
设置一个元素为圆形，用在例如头像的显示，且设置为左浮动
</code></pre><h4 id="sprite-image-url-pos-x-pos-y-width-height"><a href="#sprite-image-url-pos-x-pos-y-width-height" class="headerlink" title="sprite(image_url, pos_x, pos_y, width, height)"></a>sprite(image_url, pos_x, pos_y, width, height)</h4><pre><code>image_url 图片位置
pos_x 雪碧图X坐标偏移
pos_y 雪碧图Y坐标偏移
width 雪碧图宽度
height 雪碧图高度
用来显示一个雪碧图
</code></pre><h4 id="contentCenter-outer-height-inner-height"><a href="#contentCenter-outer-height-inner-height" class="headerlink" title="contentCenter(outer_height, inner_height)"></a>contentCenter(outer_height, inner_height)</h4><pre><code>outer_height 外包盒高度
inner_height 内容盒高度
实现一个盒在另一个盒中的垂直居中，使用Padding实现
</code></pre><h4 id="contentCenterM-outer-height-inner-height"><a href="#contentCenterM-outer-height-inner-height" class="headerlink" title="contentCenterM(outer_height, inner_height)"></a>contentCenterM(outer_height, inner_height)</h4><pre><code>outer_height 外包盒高度
inner_height 内容盒高度
同上，使用Margin实现
</code></pre><h4 id="circleBorder-border-style"><a href="#circleBorder-border-style" class="headerlink" title="circleBorder(border_style)"></a>circleBorder(border_style)</h4><pre><code>border_style 外边框样式 例如 1px solid red
为一个元素进行圆形描边
</code></pre><h4 id="rmb2"><a href="#rmb2" class="headerlink" title="rmb2()"></a>rmb2()</h4><pre><code>给一个元素前方加入人民币¥符号，间隔5px
</code></pre><h4 id="multiline-overflow-line-number"><a href="#multiline-overflow-line-number" class="headerlink" title="multiline-overflow(line_number)"></a>multiline-overflow(line_number)</h4><pre><code>line_number 允许显示的行数
多行溢出加省略号，仅适用Webkit内核浏览器
</code></pre><h4 id="triangle-heading-width-height-color"><a href="#triangle-heading-width-height-color" class="headerlink" title="triangle(heading, width, height, color)"></a>triangle(heading, width, height, color)</h4><pre><code>heading 朝向，可选[up, down, left, right]
width 三角底边宽度
height 三角高
color 颜色
用CSS画一个三角
</code></pre><h4 id="loading-zoom-margin"><a href="#loading-zoom-margin" class="headerlink" title="loading(zoom, margin)"></a>loading(zoom, margin)</h4><pre><code>zoom 缩放系数 典型值0.4
margin  上边距 典型值1000px
页面Loading样式

.loading {
    @include loading(0.4,1000px auto);
}
</code></pre><p>需要加入以下HTML代码</p>
<pre><code>&lt;div class=&quot;loading&quot;&gt;
  &lt;div class=&quot;title&quot;&gt;小红唇&lt;/div&gt;
  &lt;div class=&quot;subtitle&quot;&gt;你的变美频道&lt;/div&gt;
  &lt;div class=&quot;sharp1&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;sharp2&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;sharp3&quot;&gt;&lt;/div&gt;
  &lt;div class=&quot;sharp4&quot;&gt;&lt;/div&gt;
&lt;/div&gt;
</code></pre><hr>
<h2 id="自动化"><a href="#自动化" class="headerlink" title="自动化"></a>自动化</h2><p>gulp自动化工具的task列表：</p>
<ul>
<li><strong>default</strong>         wactch + connect</li>
<li><strong>sass</strong>            编译app目录中的sass文件</li>
<li><strong>watch</strong>           监视scss目录中的所有scss文件并监视app文件夹中文件以进行LiveReload</li>
<li><strong>connect</strong>         启动本地服务器</li>
<li><strong>test</strong>            将代码部署到本地测试环境</li>
<li><strong>preview</strong>         将代码部署到预演环境</li>
<li><strong>preview-lib</strong>     将公共库部署到预演环境</li>
<li><strong>product</strong>         将代码部署到生产环境</li>
<li><strong>product-lib</strong>     将公共库部署到生产环境</li>
<li><strong>publish</strong>         发布App</li>
<li><strong>publish-lib</strong>     发布公共库</li>
</ul>
<hr>
<h2 id="自建接口"><a href="#自建接口" class="headerlink" title="自建接口"></a>自建接口</h2><h3 id="收获地址中的城市列表"><a href="#收获地址中的城市列表" class="headerlink" title="收获地址中的城市列表"></a>收获地址中的城市列表</h3><h4 id="获取省份列表（不包括港澳台）"><a href="#获取省份列表（不包括港澳台）" class="headerlink" title="获取省份列表（不包括港澳台）"></a>获取省份列表（不包括港澳台）</h4><p>  <a href="http://static.xiaohongchun.com/store/city/province.json" target="_blank" rel="noopener">http://static.xiaohongchun.com/store/city/province.json</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">结果:&#123;</span><br><span class="line">  code: <span class="number">0</span>,</span><br><span class="line">  data: [<span class="string">'北京市'</span>, <span class="string">'天津市'</span>, ...]  <span class="comment">// 省份名</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="获取城市和区域列表"><a href="#获取城市和区域列表" class="headerlink" title="获取城市和区域列表"></a>获取城市和区域列表</h4><p>  <a href="http://static.xiaohongchun.com/store/city/{省份名}.json" target="_blank" rel="noopener">http://static.xiaohongchun.com/store/city/{省份名}.json</a></p>
<p>  省份名直接穿中文，例如 北京市.json</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">结果:&#123;</span><br><span class="line">  code: <span class="number">0</span>,</span><br><span class="line">  data: [</span><br><span class="line">    &#123;</span><br><span class="line">      name: <span class="string">'青岛市'</span> <span class="comment">//城市名</span></span><br><span class="line">      district :[</span><br><span class="line">        &#123;</span><br><span class="line">          name: <span class="string">'市南区'</span> <span class="comment">//区域名</span></span><br><span class="line">          zipcode: <span class="string">'266001'</span> <span class="comment">//邮编</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="知识库"><a href="#知识库" class="headerlink" title="知识库"></a>知识库</h2><h4 id="iOS-Safari浏览器不响应click事件"><a href="#iOS-Safari浏览器不响应click事件" class="headerlink" title="iOS Safari浏览器不响应click事件"></a>iOS Safari浏览器不响应click事件</h4><p>  Safari浏览器中不管是在DOM中或是在js中进行click事件的绑定，默认都不会被响应</p>
<p><strong>解决方案</strong> 给对应的DOM元素添加如下css属性</p>
<p>  cursor: pointer;</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="https://avatars1.githubusercontent.com/u/14329197?s=460&v=4"
                alt="xiao.liang" />
            
              <p class="site-author-name" itemprop="name">xiao.liang</p>
              <p class="site-description motion-element" itemprop="description">当编程成为一种习惯...</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">3</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/xiaopili" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="495361365@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i></a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://www.facebook.com/profile.php?id=100013546216262" target="_blank" title="FB Page">
                      
                        <i class="fa fa-fw fa-facebook"></i></a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xiao.liang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
